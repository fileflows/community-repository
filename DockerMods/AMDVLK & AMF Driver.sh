# ----------------------------------------------------------------------------------------------------
# Name: AMDVLK & AMF Driver
# Description: This DockerMod script provides a simple and idempotent way to install and manage the AMDVLK open-source Vulkan driver and AMF (Advanced Media Framework) components for hardware video encoding. It includes checks to prevent re-installation and an uninstall option for clean removal.
# Revision: 1
# Icon: data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgoKPHN2ZwogICB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iCiAgIHhtbG5zOmNjPSJodHRwOi8vY3JlYXRpdmVjb21tb25zLm9yZy9ucyMiCiAgIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyIKICAgeG1sbnM6c3ZnPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIKICAgeG1sbnM6c29kaXBvZGk9Imh0dHA6Ly9zb2RpcG9kaS5zb3VyY2Vmb3JnZS5uZXQvRFREL3NvZGlwb2RpLTAuZHRkIgogICB4bWxuczppbmtzY2FwZT0iaHR0cDovL3d3dy5pbmtzY2FwZS5vcmcvbmFtZXNwYWNlcy9pbmtzY2FwZSIKICAgaW5rc2NhcGU6ZXhwb3J0LXlkcGk9IjEwMCIKICAgaW5rc2NhcGU6ZXhwb3J0LXhkcGk9IjEwMCIKICAgaW5rc2NhcGU6ZXhwb3J0LWZpbGVuYW1lPSIvaG9tZS9hbGVjaXZlL1Njcml2YW5pYS9maXJlZm94VGVzdDEucG5nIgogICBzb2RpcG9kaTpkb2NuYW1lPSJhbWQtYXRpLnN2ZyIKICAgaW5rc2NhcGU6dmVyc2lvbj0iMC40OC4zLjEgcjk4ODYiCiAgIHZlcnNpb249IjEuMSIKICAgaWQ9InN2ZzIiCiAgIGhlaWdodD0iNTEyIgogICB3aWR0aD0iNTEyIj4KICA8c29kaXBvZGk6bmFtZWR2aWV3CiAgICAgaWQ9ImJhc2UiCiAgICAgcGFnZWNvbG9yPSIjZmZmZmZmIgogICAgIGJvcmRlcmNvbG9yPSIjNjY2NjY2IgogICAgIGJvcmRlcm9wYWNpdHk9IjEuMCIKICAgICBpbmtzY2FwZTpwYWdlb3BhY2l0eT0iMC4wIgogICAgIGlua3NjYXBlOnBhZ2VzaGFkb3c9IjIiCiAgICAgaW5rc2NhcGU6em9vbT0iMS41ODI5MDE2IgogICAgIGlua3NjYXBlOmN4PSIyOTkiCiAgICAgaW5rc2NhcGU6Y3k9IjIxMyIKICAgICBpbmtzY2FwZTpkb2N1bWVudC11bml0cz0icHgiCiAgICAgaW5rc2NhcGU6Y3VycmVudC1sYXllcj0ic3ZnMiIKICAgICBzaG93Z3JpZD0iZmFsc2UiCiAgICAgaW5rc2NhcGU6d2luZG93LXdpZHRoPSIxMzAxIgogICAgIGlua3NjYXBlOndpbmRvdy1oZWlnaHQ9Ijc0NCIKICAgICBpbmtzY2FwZTp3aW5kb3cteD0iNjUiCiAgICAgaW5rc2NhcGU6d2luZG93LXk9IjI0IgogICAgIGlua3NjYXBlOndpbmRvdy1tYXhpbWl6ZWQ9IjEiCiAgICAgaW5rc2NhcGU6b2JqZWN0LXBhdGhzPSJmYWxzZSIKICAgICBpbmtzY2FwZTpzbmFwLWludGVyc2VjdGlvbi1wYXRocz0iZmFsc2UiCiAgICAgaW5rc2NhcGU6b2JqZWN0LW5vZGVzPSJ0cnVlIgogICAgIGlua3NjYXBlOnNuYXAtc21vb3RoLW5vZGVzPSJ0cnVlIgogICAgIGlua3NjYXBlOnNuYXAtbm9kZXM9InRydWUiIC8+CiAgPGRlZnMKICAgICBpZD0iZGVmczQiPgogICAgPGxpbmVhckdyYWRpZW50CiAgICAgICBpZD0ibGluZWFyR3JhZGllbnQyNDYwIgogICAgICAgeTI9IjQ0Ljk4NDAwMSIKICAgICAgIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIgogICAgICAgeDI9IjE5LjM2MDAwMSIKICAgICAgIHkxPSIyMS4wMzA4MDQiCiAgICAgICB4MT0iMTkuMjQ0OTk5Ij4KICAgICAgPHN0b3AKICAgICAgICAgaWQ9InN0b3AzNjAyIgogICAgICAgICBzdHlsZT0ic3RvcC1jb2xvcjojZmFmYWZhO3N0b3Atb3BhY2l0eToxOyIKICAgICAgICAgb2Zmc2V0PSIwIiAvPgogICAgICA8c3RvcAogICAgICAgICBpZD0ic3RvcDM2MDQiCiAgICAgICAgIHN0eWxlPSJzdG9wLWNvbG9yOiNmMGYwZjA7c3RvcC1vcGFjaXR5OjE7IgogICAgICAgICBvZmZzZXQ9IjEiIC8+CiAgICA8L2xpbmVhckdyYWRpZW50PgogICAgPGxpbmVhckdyYWRpZW50CiAgICAgICB5Mj0iMjAuNjI1OTE2IgogICAgICAgeDI9IjEwMDYuODA4MiIKICAgICAgIHkxPSI0ODQuNDE3MjEiCiAgICAgICB4MT0iMTAxMi41MTMzIgogICAgICAgZ3JhZGllbnRUcmFuc2Zvcm09Im1hdHJpeCgxLjAzMTc3OTYsMCwwLDEuMDMxNzc5NiwtODMwLjg2NDA2LDU5Mi42Nzc5MSkiCiAgICAgICBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIKICAgICAgIGlkPSJsaW5lYXJHcmFkaWVudDQxMTQtMi02IgogICAgICAgeGxpbms6aHJlZj0iI0J1dHRvblNoYWRvdy0wLTEtMS01LTkiCiAgICAgICBpbmtzY2FwZTpjb2xsZWN0PSJhbHdheXMiIC8+CiAgICA8bGluZWFyR3JhZGllbnQKICAgICAgIGdyYWRpZW50VHJhbnNmb3JtPSJtYXRyaXgoMS4wMDU4NjUyLDAsMCwwLjk5NDE2OSwxMDAsMCkiCiAgICAgICBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIKICAgICAgIGlkPSJCdXR0b25TaGFkb3ctMC0xLTEtNS05IgogICAgICAgeTI9IjcuMDE2NTM5NiIKICAgICAgIHgyPSI0NS40NDc3MjciCiAgICAgICB5MT0iOTIuNTM5NTk3IgogICAgICAgeDE9IjQ1LjQ0NzcyNyI+CiAgICAgIDxzdG9wCiAgICAgICAgIG9mZnNldD0iMCIKICAgICAgICAgc3R5bGU9InN0b3AtY29sb3I6IzAwMDAwMDtzdG9wLW9wYWNpdHk6MSIKICAgICAgICAgaWQ9InN0b3AzNzUwLTgtOS0zLTYtNCIgLz4KICAgICAgPHN0b3AKICAgICAgICAgb2Zmc2V0PSIxIgogICAgICAgICBzdHlsZT0ic3RvcC1jb2xvcjojMDAwMDAwO3N0b3Atb3BhY2l0eTowLjU4ODIzNTMyIgogICAgICAgICBpZD0ic3RvcDM3NTItNS02LTQtMi05IiAvPgogICAgPC9saW5lYXJHcmFkaWVudD4KICAgIDxsaW5lYXJHcmFkaWVudAogICAgICAgeTI9IjIwLjYyNTkxNiIKICAgICAgIHgyPSIxMDA2LjgwODIiCiAgICAgICB5MT0iNDg0LjQxNzIxIgogICAgICAgeDE9IjEwMTIuNTEzMyIKICAgICAgIGdyYWRpZW50VHJhbnNmb3JtPSJtYXRyaXgoMS4wNDAyNTQxLDAsMCwxLjA0MDI1NDEsLTgzNy45NTExNiw1OTIuNTE4MjUpIgogICAgICAgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiCiAgICAgICBpZD0ibGluZWFyR3JhZGllbnQ0MTEyLTItNiIKICAgICAgIHhsaW5rOmhyZWY9IiNCdXR0b25TaGFkb3ctMC0xLTEtNS05IgogICAgICAgaW5rc2NhcGU6Y29sbGVjdD0iYWx3YXlzIiAvPgogICAgPGxpbmVhckdyYWRpZW50CiAgICAgICB5Mj0iMjAuNjI1OTE2IgogICAgICAgeDI9IjEwMDYuODA4MiIKICAgICAgIHkxPSI0ODQuNDE3MjEiCiAgICAgICB4MT0iMTAxMi41MTMzIgogICAgICAgZ3JhZGllbnRUcmFuc2Zvcm09Im1hdHJpeCgxLjAyMzMwNSwwLDAsMS4wMjMzMDUsLTgyMy43NzcwNCw1OTIuODM3NTcpIgogICAgICAgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiCiAgICAgICBpZD0ibGluZWFyR3JhZGllbnQ0MTEwLTYtNyIKICAgICAgIHhsaW5rOmhyZWY9IiNCdXR0b25TaGFkb3ctMC0xLTEtNS05IgogICAgICAgaW5rc2NhcGU6Y29sbGVjdD0iYWx3YXlzIiAvPgogICAgPGxpbmVhckdyYWRpZW50CiAgICAgICB5Mj0iMjAuNjI1OTE2IgogICAgICAgeDI9IjEwMDYuODA4MiIKICAgICAgIHkxPSI0ODQuNDE3MjEiCiAgICAgICB4MT0iMTAxMi41MTMzIgogICAgICAgZ3JhZGllbnRUcmFuc2Zvcm09Im1hdHJpeCgxLjAxNDgzMDUsMCwwLDEuMDE0ODMwNSwtODE2LjY4OTk2LDU5Mi45OTcyMykiCiAgICAgICBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIKICAgICAgIGlkPSJsaW5lYXJHcmFkaWVudDQxMTYtNi0zIgogICAgICAgeGxpbms6aHJlZj0iI0J1dHRvblNoYWRvdy0wLTEtMS01LTkiCiAgICAgICBpbmtzY2FwZTpjb2xsZWN0PSJhbHdheXMiIC8+CiAgICA8bGluZWFyR3JhZGllbnQKICAgICAgIGlua3NjYXBlOmNvbGxlY3Q9ImFsd2F5cyIKICAgICAgIHhsaW5rOmhyZWY9IiNCdXR0b25TaGFkb3ctMC0xLTEtNS05IgogICAgICAgaWQ9ImxpbmVhckdyYWRpZW50NTM0Mi0zIgogICAgICAgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiCiAgICAgICBncmFkaWVudFRyYW5zZm9ybT0ibWF0cml4KDEuMDA3NDE1MywwLDAsMS4wMDc0MTUzLC04MTAuNDg4NzksNTkzLjEzNjkpIgogICAgICAgeDE9IjEwMTIuNTEzMyIKICAgICAgIHkxPSI0ODQuNDE3MjEiCiAgICAgICB4Mj0iMTAwNi44MDgyIgogICAgICAgeTI9IjIwLjYyNTkxNiIgLz4KICAgIDxsaW5lYXJHcmFkaWVudAogICAgICAgeTI9IjM2My43MzgyNSIKICAgICAgIHgyPSI5ODguNzg1NTIiCiAgICAgICB5MT0iNTEuNTExNzY1IgogICAgICAgeDE9Ijk5My40Mzg5NiIKICAgICAgIGdyYWRpZW50VHJhbnNmb3JtPSJ0cmFuc2xhdGUoNzc4LjU5OTc5LC0zNjAuNTU5NjMpIgogICAgICAgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiCiAgICAgICBpZD0ibGluZWFyR3JhZGllbnQ0MDg0LTgiCiAgICAgICB4bGluazpocmVmPSIjbGluZWFyR3JhZGllbnQzNzM3LTkiCiAgICAgICBpbmtzY2FwZTpjb2xsZWN0PSJhbHdheXMiIC8+CiAgICA8bGluZWFyR3JhZGllbnQKICAgICAgIGlkPSJsaW5lYXJHcmFkaWVudDM3MzctOSI+CiAgICAgIDxzdG9wCiAgICAgICAgIG9mZnNldD0iMCIKICAgICAgICAgc3R5bGU9InN0b3AtY29sb3I6I2ZmZmZmZjtzdG9wLW9wYWNpdHk6MSIKICAgICAgICAgaWQ9InN0b3AzNzM5LTciIC8+CiAgICAgIDxzdG9wCiAgICAgICAgIG9mZnNldD0iMSIKICAgICAgICAgc3R5bGU9InN0b3AtY29sb3I6I2ZmZmZmZjtzdG9wLW9wYWNpdHk6MCIKICAgICAgICAgaWQ9InN0b3AzNzQxLTQiIC8+CiAgICA8L2xpbmVhckdyYWRpZW50PgogICAgPGxpbmVhckdyYWRpZW50CiAgICAgICB5Mj0iLTU1Ljk0MTIxNiIKICAgICAgIHgyPSIxNzYzLjY5MDMiCiAgICAgICB5MT0iMTU1LjU5Njg1IgogICAgICAgeDE9IjE3NjQuNjQ4NyIKICAgICAgIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIgogICAgICAgaWQ9ImxpbmVhckdyYWRpZW50NDA4Ni0xMiIKICAgICAgIHhsaW5rOmhyZWY9IiNsaW5lYXJHcmFkaWVudDQwNDYtMyIKICAgICAgIGlua3NjYXBlOmNvbGxlY3Q9ImFsd2F5cyIgLz4KICAgIDxsaW5lYXJHcmFkaWVudAogICAgICAgaWQ9ImxpbmVhckdyYWRpZW50NDA0Ni0zIj4KICAgICAgPHN0b3AKICAgICAgICAgb2Zmc2V0PSIwIgogICAgICAgICBzdHlsZT0ic3RvcC1jb2xvcjojMDAwMDAwO3N0b3Atb3BhY2l0eToxOyIKICAgICAgICAgaWQ9InN0b3A0MDQ4LTciIC8+CiAgICAgIDxzdG9wCiAgICAgICAgIG9mZnNldD0iMSIKICAgICAgICAgc3R5bGU9InN0b3AtY29sb3I6I2ZmZmZmZjtzdG9wLW9wYWNpdHk6MC4yIgogICAgICAgICBpZD0ic3RvcDQwNTAtNzMiIC8+CiAgICA8L2xpbmVhckdyYWRpZW50PgogICAgPGxpbmVhckdyYWRpZW50CiAgICAgICBpbmtzY2FwZTpjb2xsZWN0PSJhbHdheXMiCiAgICAgICB4bGluazpocmVmPSIjbGluZWFyR3JhZGllbnQ0MDcyIgogICAgICAgaWQ9ImxpbmVhckdyYWRpZW50NDA3OCIKICAgICAgIHgxPSIzNS45MzU4MjkiCiAgICAgICB5MT0iMTA0My45MjAyIgogICAgICAgeDI9IjM1LjkzNTgyOSIKICAgICAgIHkyPSIxMDEzLjExOCIKICAgICAgIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIiAvPgogICAgPGxpbmVhckdyYWRpZW50CiAgICAgICBpbmtzY2FwZTpjb2xsZWN0PSJhbHdheXMiCiAgICAgICBpZD0ibGluZWFyR3JhZGllbnQ0MDcyIj4KICAgICAgPHN0b3AKICAgICAgICAgc3R5bGU9InN0b3AtY29sb3I6I2MzNDAwMDtzdG9wLW9wYWNpdHk6MTsiCiAgICAgICAgIG9mZnNldD0iMCIKICAgICAgICAgaWQ9InN0b3A0MDc0IiAvPgogICAgICA8c3RvcAogICAgICAgICBzdHlsZT0ic3RvcC1jb2xvcjojZmY3NTMxO3N0b3Atb3BhY2l0eToxIgogICAgICAgICBvZmZzZXQ9IjEiCiAgICAgICAgIGlkPSJzdG9wNDA3NiIgLz4KICAgIDwvbGluZWFyR3JhZGllbnQ+CiAgICA8bGluZWFyR3JhZGllbnQKICAgICAgIHgxPSI2LjYyMDEzMDEiCiAgICAgICB5MT0iMTYuMzg0Njg3IgogICAgICAgeDI9IjYuNjIwMTMwMSIKICAgICAgIHkyPSIxLjA5MjMxMjIiCiAgICAgICBpZD0ibGluZWFyR3JhZGllbnQzMDUzIgogICAgICAgeGxpbms6aHJlZj0iI2xpbmVhckdyYWRpZW50MzczMSIKICAgICAgIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIgogICAgICAgZ3JhZGllbnRUcmFuc2Zvcm09Im1hdHJpeCgtNC41MDU3ODgzLDAsMCwzLjg4NDI4ODcsODEuMTI4OTA2LDE0LjA1NzE0NCkiIC8+CiAgICA8bGluZWFyR3JhZGllbnQKICAgICAgIGlkPSJsaW5lYXJHcmFkaWVudDM3MzEiPgogICAgICA8c3RvcAogICAgICAgICBpZD0ic3RvcDM3MzMiCiAgICAgICAgIHN0eWxlPSJzdG9wLWNvbG9yOiNkY2RjZGM7c3RvcC1vcGFjaXR5OjEiCiAgICAgICAgIG9mZnNldD0iMCIgLz4KICAgICAgPHN0b3AKICAgICAgICAgaWQ9InN0b3AzNzU3IgogICAgICAgICBzdHlsZT0ic3RvcC1jb2xvcjojZWJlYmViO3N0b3Atb3BhY2l0eToxIgogICAgICAgICBvZmZzZXQ9IjAuMzA2NTQxNTMiIC8+CiAgICAgIDxzdG9wCiAgICAgICAgIGlkPSJzdG9wMzczNyIKICAgICAgICAgc3R5bGU9InN0b3AtY29sb3I6I2ZmZmZmZjtzdG9wLW9wYWNpdHk6MSIKICAgICAgICAgb2Zmc2V0PSIwLjcwNzA2MDc1IiAvPgogICAgICA8c3RvcAogICAgICAgICBpZD0ic3RvcDM3NTkiCiAgICAgICAgIHN0eWxlPSJzdG9wLWNvbG9yOiNmYWZhZmE7c3RvcC1vcGFjaXR5OjEiCiAgICAgICAgIG9mZnNldD0iMC44NDUwMTQ5MyIgLz4KICAgICAgPHN0b3AKICAgICAgICAgaWQ9InN0b3AzNzM1IgogICAgICAgICBzdHlsZT0ic3RvcC1jb2xvcjojZjBmMGYwO3N0b3Atb3BhY2l0eToxIgogICAgICAgICBvZmZzZXQ9IjEiIC8+CiAgICA8L2xpbmVhckdyYWRpZW50PgogICAgPGxpbmVhckdyYWRpZW50CiAgICAgICB4MT0iNDgiCiAgICAgICB5MT0iOTAiCiAgICAgICB4Mj0iNDgiCiAgICAgICB5Mj0iNS45ODc3MTcyIgogICAgICAgaWQ9ImxpbmVhckdyYWRpZW50MzYxNyIKICAgICAgIHhsaW5rOmhyZWY9IiNsaW5lYXJHcmFkaWVudDI4ODEiCiAgICAgICBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgLz4KICAgIDxsaW5lYXJHcmFkaWVudAogICAgICAgaWQ9ImxpbmVhckdyYWRpZW50Mjg4MSI+CiAgICAgIDxzdG9wCiAgICAgICAgIGlkPSJzdG9wMjg4MyIKICAgICAgICAgc3R5bGU9InN0b3AtY29sb3I6I2E5MGMwYztzdG9wLW9wYWNpdHk6MSIKICAgICAgICAgb2Zmc2V0PSIwIiAvPgogICAgICA8c3RvcAogICAgICAgICBpZD0ic3RvcDI4ODUiCiAgICAgICAgIHN0eWxlPSJzdG9wLWNvbG9yOiNmMDU1MzA7c3RvcC1vcGFjaXR5OjEiCiAgICAgICAgIG9mZnNldD0iMSIgLz4KICAgIDwvbGluZWFyR3JhZGllbnQ+CiAgICA8bGluZWFyR3JhZGllbnQKICAgICAgIGlkPSJsaW5lYXJHcmFkaWVudDI4ODEtOSI+CiAgICAgIDxzdG9wCiAgICAgICAgIGlkPSJzdG9wMjg4My0yIgogICAgICAgICBzdHlsZT0ic3RvcC1jb2xvcjojYTkwYzBjO3N0b3Atb3BhY2l0eToxIgogICAgICAgICBvZmZzZXQ9IjAiIC8+CiAgICAgIDxzdG9wCiAgICAgICAgIGlkPSJzdG9wMjg4NS01IgogICAgICAgICBzdHlsZT0ic3RvcC1jb2xvcjojZjA1NTMwO3N0b3Atb3BhY2l0eToxIgogICAgICAgICBvZmZzZXQ9IjEiIC8+CiAgICA8L2xpbmVhckdyYWRpZW50PgogICAgPGxpbmVhckdyYWRpZW50CiAgICAgICBncmFkaWVudFRyYW5zZm9ybT0ibWF0cml4KDUuNjE5MDQ3NiwwLDAsNS42MTkwNDc2LC0zMy43MTQyODYsLTMzLjcxNDI4NikiCiAgICAgICB5Mj0iNS45ODc3MTcyIgogICAgICAgeDI9IjQ4IgogICAgICAgeTE9IjkwIgogICAgICAgeDE9IjQ4IgogICAgICAgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiCiAgICAgICBpZD0ibGluZWFyR3JhZGllbnQzNTc5IgogICAgICAgeGxpbms6aHJlZj0iI2xpbmVhckdyYWRpZW50Mjg4MS05IgogICAgICAgaW5rc2NhcGU6Y29sbGVjdD0iYWx3YXlzIiAvPgogIDwvZGVmcz4KICA8bWV0YWRhdGEKICAgICBpZD0ibWV0YWRhdGE3Ij4KICAgIDxyZGY6UkRGPgogICAgICA8Y2M6V29yawogICAgICAgICByZGY6YWJvdXQ9IiI+CiAgICAgICAgPGRjOmZvcm1hdD5pbWFnZS9zdmcreG1sPC9kYzpmb3JtYXQ+CiAgICAgICAgPGRjOnR5cGUKICAgICAgICAgICByZGY6cmVzb3VyY2U9Imh0dHA6Ly9wdXJsLm9yZy9kYy9kY21pdHlwZS9TdGlsbEltYWdlIiAvPgogICAgICAgIDxkYzp0aXRsZSAvPgogICAgICA8L2NjOldvcms+CiAgICA8L3JkZjpSREY+CiAgPC9tZXRhZGF0YT4KICA8ZwogICAgIHRyYW5zZm9ybT0idHJhbnNsYXRlKDAsLTU0MC4zNjIxOCkiCiAgICAgaW5rc2NhcGU6bGFiZWw9IkxpdmVsbG8gMSIKICAgICBpbmtzY2FwZTpncm91cG1vZGU9ImxheWVyIgogICAgIGlkPSJsYXllcjEiIC8+CiAgPGcKICAgICB0cmFuc2Zvcm09Im1hdHJpeCgxLjEsMCwwLDAuNDQ0NDQsOTUuMDgxMDYzLDI1Ni4zOTI1NCkiCiAgICAgaWQ9ImcyMDM2Ij4KICAgIDxnCiAgICAgICB0cmFuc2Zvcm09Im1hdHJpeCgxLjA1MjYsMCwwLDEuMjg1NywtMS4yNjMyLC0xMy40MjkpIgogICAgICAgc3R5bGU9Im9wYWNpdHk6MC40IgogICAgICAgaWQ9ImczNzEyIiAvPgogIDwvZz4KICA8ZwogICAgIGlkPSJnMzU0MSIKICAgICB0cmFuc2Zvcm09InRyYW5zbGF0ZSg5Ny40ODEwNjMsMjMxLjI4MTU0KSIgLz4KICA8ZwogICAgIGlkPSJnMzUzNiIKICAgICB0cmFuc2Zvcm09InRyYW5zbGF0ZSg5Ny40ODEwNjMsMjMxLjI4MTU0KSIgLz4KICA8ZwogICAgIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0xMS45ODUwNzEsLTU5Mi4xMTcxOSkiCiAgICAgaWQ9Imc0MTAzIj4KICAgIDxyZWN0CiAgICAgICBzdHlsZT0ib3BhY2l0eTowLjE7Y29sb3I6IzAwMDAwMDtmaWxsOnVybCgjbGluZWFyR3JhZGllbnQ0MTE0LTItNik7ZmlsbC1vcGFjaXR5OjE7ZmlsbC1ydWxlOm5vbnplcm87c3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjEuNTttYXJrZXI6bm9uZTt2aXNpYmlsaXR5OnZpc2libGU7ZGlzcGxheTppbmxpbmU7b3ZlcmZsb3c6dmlzaWJsZTtlbmFibGUtYmFja2dyb3VuZDphY2N1bXVsYXRlIgogICAgICAgaWQ9InJlY3Q2MTg3IgogICAgICAgd2lkdGg9IjQ4NyIKICAgICAgIGhlaWdodD0iNDg3IgogICAgICAgeD0iMzEuOTg1MDcxIgogICAgICAgeT0iNjEyLjExNzE5IgogICAgICAgcnk9IjEwMS40NTgzNCIgLz4KICAgIDxyZWN0CiAgICAgICByeT0iMTAyLjI5MTY3IgogICAgICAgeT0iNjEyLjExNzE5IgogICAgICAgeD0iMzEuOTg1MDcxIgogICAgICAgaGVpZ2h0PSI0OTEiCiAgICAgICB3aWR0aD0iNDkxIgogICAgICAgaWQ9InJlY3Q2MTkxIgogICAgICAgc3R5bGU9Im9wYWNpdHk6MC4wNzk5OTk5ODtjb2xvcjojMDAwMDAwO2ZpbGw6dXJsKCNsaW5lYXJHcmFkaWVudDQxMTItMi02KTtmaWxsLW9wYWNpdHk6MTtmaWxsLXJ1bGU6bm9uemVybztzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MS41O21hcmtlcjpub25lO3Zpc2liaWxpdHk6dmlzaWJsZTtkaXNwbGF5OmlubGluZTtvdmVyZmxvdzp2aXNpYmxlO2VuYWJsZS1iYWNrZ3JvdW5kOmFjY3VtdWxhdGUiIC8+CiAgICA8cmVjdAogICAgICAgcnk9IjEwMC42MjUwMSIKICAgICAgIHk9IjYxMi4xMTcxOSIKICAgICAgIHg9IjMxLjk4NTA3MSIKICAgICAgIGhlaWdodD0iNDgzIgogICAgICAgd2lkdGg9IjQ4MyIKICAgICAgIGlkPSJyZWN0NjE4MyIKICAgICAgIHN0eWxlPSJvcGFjaXR5OjAuMjtjb2xvcjojMDAwMDAwO2ZpbGw6dXJsKCNsaW5lYXJHcmFkaWVudDQxMTAtNi03KTtmaWxsLW9wYWNpdHk6MTtmaWxsLXJ1bGU6bm9uemVybztzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MS41O21hcmtlcjpub25lO3Zpc2liaWxpdHk6dmlzaWJsZTtkaXNwbGF5OmlubGluZTtvdmVyZmxvdzp2aXNpYmxlO2VuYWJsZS1iYWNrZ3JvdW5kOmFjY3VtdWxhdGUiIC8+CiAgICA8cmVjdAogICAgICAgc3R5bGU9Im9wYWNpdHk6MC4yNTtjb2xvcjojMDAwMDAwO2ZpbGw6dXJsKCNsaW5lYXJHcmFkaWVudDQxMTYtNi0zKTtmaWxsLW9wYWNpdHk6MTtmaWxsLXJ1bGU6bm9uemVybztzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MS41O21hcmtlcjpub25lO3Zpc2liaWxpdHk6dmlzaWJsZTtkaXNwbGF5OmlubGluZTtvdmVyZmxvdzp2aXNpYmxlO2VuYWJsZS1iYWNrZ3JvdW5kOmFjY3VtdWxhdGUiCiAgICAgICBpZD0icmVjdDYxNzkiCiAgICAgICB3aWR0aD0iNDc5IgogICAgICAgaGVpZ2h0PSI0NzkiCiAgICAgICB4PSIzMS45ODUwNzEiCiAgICAgICB5PSI2MTIuMTE3MTkiCiAgICAgICByeT0iOTkuNzkxNjY0IiAvPgogICAgPHJlY3QKICAgICAgIHJ5PSI5OS4wNjI1IgogICAgICAgeT0iNjEyLjExNzE5IgogICAgICAgeD0iMzEuOTg1MDcxIgogICAgICAgaGVpZ2h0PSI0NzUuNSIKICAgICAgIHdpZHRoPSI0NzUuNSIKICAgICAgIGlkPSJyZWN0NTU3NCIKICAgICAgIHN0eWxlPSJvcGFjaXR5OjAuMjU7Y29sb3I6IzAwMDAwMDtmaWxsOnVybCgjbGluZWFyR3JhZGllbnQ1MzQyLTMpO2ZpbGwtb3BhY2l0eToxO2ZpbGwtcnVsZTpub256ZXJvO3N0cm9rZTpub25lO3N0cm9rZS13aWR0aDoxLjU7bWFya2VyOm5vbmU7dmlzaWJpbGl0eTp2aXNpYmxlO2Rpc3BsYXk6aW5saW5lO292ZXJmbG93OnZpc2libGU7ZW5hYmxlLWJhY2tncm91bmQ6YWNjdW11bGF0ZSIgLz4KICA8L2c+CiAgPHBhdGgKICAgICBpbmtzY2FwZTpjb25uZWN0b3ItY3VydmF0dXJlPSIwIgogICAgIGlkPSJyZWN0NTUwNSIKICAgICBkPSJNIDExOC4zNDM3NSwyMCBDIDYzLjg2NzA4NywyMCAyMCw2My44NjcwODQgMjAsMTE4LjM0Mzc1IGwgMCwyMy4wNjI1IDAsMjUyLjI1IEMgMjAsNDQ4LjEzMjkxIDYzLjg2NzA4Nyw0OTIgMTE4LjM0Mzc1LDQ5MiBsIDI3NS4zMTI1LDAgQyA0NDguMTMyOTIsNDkyIDQ5Miw0NDguMTMyOTEgNDkyLDM5My42NTYyNSBsIDAsLTI1Mi4yNSAwLC0yMy4wNjI1IEMgNDkyLDYzLjg2NzA4NCA0NDguMTMyOTIsMjAgMzkzLjY1NjI1LDIwIGwgLTI3NS4zMTI1LDAgeiIKICAgICBzdHlsZT0iZmlsbDojY2QwZjBmO3N0cm9rZTpub25lO2NvbG9yOiMwMDAwMDA7ZmlsbC1vcGFjaXR5OjE7ZmlsbC1ydWxlOm5vbnplcm87bWFya2VyOm5vbmU7dmlzaWJpbGl0eTp2aXNpYmxlO2Rpc3BsYXk6aW5saW5lO292ZXJmbG93OnZpc2libGU7ZW5hYmxlLWJhY2tncm91bmQ6YWNjdW11bGF0ZSIgLz4KICA8ZwogICAgIHRyYW5zZm9ybT0idHJhbnNsYXRlKC02MDUuNTE5MzIsLTM1My45NjgzMykiCiAgICAgaWQ9Imc0MDc2Ij4KICAgIDxnCiAgICAgICBpZD0iZzQwMzgiCiAgICAgICB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtOTI2LjY2NzU4LDY4NC4zODQ0OCkiIC8+CiAgPC9nPgogIDxwYXRoCiAgICAgc3R5bGU9ImZpbGw6IzAwMDAwMDtmaWxsLW9wYWNpdHk6MC4yMzUyOTQxMjtzdHJva2U6bm9uZTtkaXNwbGF5OmlubGluZTtlbmFibGUtYmFja2dyb3VuZDpuZXciCiAgICAgZD0ibSAxMDYsMTA2IDEuNSwxLjUgODMuNTYyNSw4My41NjI1IEwgMTkyLjUsMTkyLjUgMTA2LDI3Ny45MDYyNSAxMDYsNDA2IGwgODYuNTYyNSw4NiAyMDEuMDkzNzUsMCBDIDQ0OC4xMzI5Miw0OTIgNDkyLDQ0OC4xMzI5MSA0OTIsMzkzLjY1NjI1IEwgNDkyLDE5Mi41NjI1IDQwNiwxMDYgeiBtIDg3LjUsODcuNSAxMjUsMCAwLDEyNC45Mzc1IC0xMjUsMC4wNjI1IHoiCiAgICAgaWQ9InBhdGg1MjkxIgogICAgIGlua3NjYXBlOmNvbm5lY3Rvci1jdXJ2YXR1cmU9IjAiCiAgICAgc29kaXBvZGk6bm9kZXR5cGVzPSJjY2NjY2Njc3NjY2NjY2NjYyIgLz4KICA8ZwogICAgIHRyYW5zZm9ybT0idHJhbnNsYXRlKC02MDUuNTE5MzcsLTM1My45NjgzMykiCiAgICAgaWQ9Imc0MDc2LTkiPgogICAgPGcKICAgICAgIGlkPSJnNDAzOC05IgogICAgICAgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTkyNi42Njc1OCw2ODQuMzg0NDgpIj4KICAgICAgPHBhdGgKICAgICAgICAgaWQ9InJlY3Q2ODA5LTItMyIKICAgICAgICAgZD0ibSAxNjUwLjQ5OTQsLTMxMC40MTYxNSBjIC01NC40NzY3LDAgLTk4LjMxMjUsNDMuODM1ODMgLTk4LjMxMjUsOTguMzEyNSBsIDAsMjc1LjM0Mzc0NyBjIDAsNTQuNDc2NjczIDQzLjgzNTgsOTguMzQzNzUzIDk4LjMxMjUsOTguMzQzNzUzIGwgMi45Mzc1LDAgYyAtNTMuMzIyNSwwIC05Ni4yNSwtNDIuOTI3NSAtOTYuMjUsLTk2LjI1MDAwMyBsIDAsLTI2OS40OTk5OTcgYyAwLC01My4zMjI1IDQyLjkyNzUsLTk2LjI1IDk2LjI1LC05Ni4yNSBsIDI2OS41MDAxLDAgYyA1My4zMjI1LDAgOTYuMjUsNDIuOTI3NSA5Ni4yNSw5Ni4yNSBsIDAsMjY5LjQ5OTk5NyBjIDAsNTMuMzIyNTAzIC00Mi45Mjc1LDk2LjI1MDAwMyAtOTYuMjUsOTYuMjUwMDAzIGwgMi45MDYyLDAgYyA1NC40NzY3LDAgOTguMzQzOCwtNDMuODY3MDggOTguMzQzOCwtOTguMzQzNzUzIGwgMCwtMjc1LjM0Mzc0NyBjIDAsLTU0LjQ3NjY3IC00My44NjcxLC05OC4zMTI1IC05OC4zNDM4LC05OC4zMTI1IGwgLTI3NS4zNDM4LDAgeiIKICAgICAgICAgc3R5bGU9Im9wYWNpdHk6MC41O2NvbG9yOiMwMDAwMDA7ZmlsbDp1cmwoI2xpbmVhckdyYWRpZW50NDA4NC04KTtmaWxsLW9wYWNpdHk6MTtmaWxsLXJ1bGU6bm9uemVybztzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MS41O21hcmtlcjpub25lO3Zpc2liaWxpdHk6dmlzaWJsZTtkaXNwbGF5OmlubGluZTtvdmVyZmxvdzp2aXNpYmxlO2VuYWJsZS1iYWNrZ3JvdW5kOmFjY3VtdWxhdGUiCiAgICAgICAgIGlua3NjYXBlOmNvbm5lY3Rvci1jdXJ2YXR1cmU9IjAiIC8+CiAgICAgIDxwYXRoCiAgICAgICAgIGlua3NjYXBlOmNvbm5lY3Rvci1jdXJ2YXR1cmU9IjAiCiAgICAgICAgIHN0eWxlPSJvcGFjaXR5OjAuMjtjb2xvcjojMDAwMDAwO2ZpbGw6dXJsKCNsaW5lYXJHcmFkaWVudDQwODYtMTIpO2ZpbGwtb3BhY2l0eToxO2ZpbGwtcnVsZTpub256ZXJvO3N0cm9rZTpub25lO3N0cm9rZS13aWR0aDoxLjU7bWFya2VyOm5vbmU7dmlzaWJpbGl0eTp2aXNpYmxlO2Rpc3BsYXk6aW5saW5lO292ZXJmbG93OnZpc2libGU7ZW5hYmxlLWJhY2tncm91bmQ6YWNjdW11bGF0ZSIKICAgICAgICAgZD0ibSAxNjUwLjQ5OTQsMTYxLjU4Mzg1IGMgLTU0LjQ3NjcsMCAtOTguMzEyNSwtNDMuODM1ODMgLTk4LjMxMjUsLTk4LjMxMjUwMyBsIDAsLTI3NS4zNDM3NDcgYyAwLC01NC40NzY2NyA0My44MzU4LC05OC4zNDM3NSA5OC4zMTI1LC05OC4zNDM3NSBsIDIuOTM3NSwwIGMgLTUzLjMyMjUsMCAtOTYuMjUsNDIuOTI3NSAtOTYuMjUsOTYuMjUgbCAwLDI2OS40OTk5OTcgYyAwLDUzLjMyMjUwMyA0Mi45Mjc1LDk2LjI1MDAwMyA5Ni4yNSw5Ni4yNTAwMDMgbCAyNjkuNTAwMSwwIGMgNTMuMzIyNSwwIDk2LjI1LC00Mi45Mjc1IDk2LjI1LC05Ni4yNTAwMDMgbCAwLC0yNjkuNDk5OTk3IGMgMCwtNTMuMzIyNSAtNDIuOTI3NSwtOTYuMjUgLTk2LjI1LC05Ni4yNSBsIDIuOTA2MiwwIGMgNTQuNDc2NywwIDk4LjM0MzgsNDMuODY3MDggOTguMzQzOCw5OC4zNDM3NSBsIDAsMjc1LjM0Mzc0NyBjIDAsNTQuNDc2NjczIC00My44NjcxLDk4LjMxMjUwMyAtOTguMzQzOCw5OC4zMTI1MDMgbCAtMjc1LjM0MzgsMCB6IgogICAgICAgICBpZD0icGF0aDM5ODEtNyIgLz4KICAgIDwvZz4KICA8L2c+CiAgPGcKICAgICBpZD0iZzM2NTEiCiAgICAgdHJhbnNmb3JtPSJtYXRyaXgoNS4yODg1MTU5LDAsMCw1LjI4ODUxNTksLTM1NjAuNDc4NSwtNDYyLjM0MzIpIiAvPgogIDxnCiAgICAgdHJhbnNmb3JtPSJtYXRyaXgoNS42MTkwNDc2LDAsMCw1LjYxOTA0NzYsLTU0Mi4wODUzNSwtMzAuMzM2MTc5KSIKICAgICBpZD0ibGF5ZXIxLTUiCiAgICAgc3R5bGU9ImRpc3BsYXk6aW5saW5lIiAvPgogIDxwYXRoCiAgICAgaWQ9InBvbHlsaW5lMyIKICAgICBkPSJNIDEwNiAxMDYgTCAxOTIuNSAxOTIuNSBMIDEwNiAyNzcuOTA2MjUgTCAxMDYgNDA2IEwgMjMyLjUgNDA2IEwgMzE4Ljg0Mzc1IDMxOC44NDM3NSBMIDQwNiA0MDUuMTU2MjUgTCA0MDYgMTA2IEwgMTA2IDEwNiB6IE0gMTkzLjUgMTkzLjUgTCAzMTguNSAxOTMuNSBMIDMxOC41IDMxOC40Mzc1IEwgMTkzLjUgMzE4LjUgTCAxOTMuNSAxOTMuNSB6ICIKICAgICBzdHlsZT0iZmlsbDojZmZmZmZmO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTpub25lO2Rpc3BsYXk6aW5saW5lO2VuYWJsZS1iYWNrZ3JvdW5kOm5ldyIgLz4KPC9zdmc+Cg==
# ----------------------------------------------------------------------------------------------------

#!/bin/bash

# Function to handle errors
function handle_error {
    echo "An error occurred. Exiting..."
    exit 1
}

# --- Verified Links ---
AMF_URL="https://repo.radeon.com/amdgpu/latest/ubuntu/pool/proprietary/a/amf-amdgpu-pro/amf-amdgpu-pro_1.4.37-2187596.24.04_amd64.deb"
ENC_URL="https://repo.radeon.com/amdgpu/latest/ubuntu/pool/proprietary/liba/libamdenc-amdgpu-pro/libamdenc-amdgpu-pro_25.10-2187596.24.04_amd64.deb"
VULKAN_URL="https://repo.radeon.com/amdgpu/latest/ubuntu/pool/proprietary/v/vulkan-amdgpu-pro/vulkan-amdgpu-pro_25.10-2187596.24.04_amd64.deb"
# ----------------------

TMP_DIR="/tmp/amdvlk_install"
EXTRACT_DIR="$TMP_DIR/extract"

# Function to check if AMDVLK is installed
function is_amdvlk_installed {
    if command -v vulkaninfo &>/dev/null && vulkaninfo --summary 2>&1 | grep -q "AMDVLK"; then
        return 0 # Installed
    else
        return 1 # Not installed
    fi
}

# Check if the --uninstall option is provided
if [ "$1" == "--uninstall" ]; then
    echo "Uninstalling AMDVLK..."

    # Remove copied libraries
    echo "Removing AMDVLK libraries..."
    rm -f /usr/lib/libamfrt64.so* \
          /usr/lib/libamdenc64.so* \
          /usr/lib/libVkAmd*.so* \
          /usr/lib/amdvlk64.so

    # Remove ICD JSON
    echo "Removing AMDVLK ICD JSON..."
    rm -f /etc/vulkan/icd.d/amd_icd64.json

    ldconfig
    echo "AMDVLK uninstallation complete."
    exit 0
fi

# Check if AMDVLK is already installed
if is_amdvlk_installed; then
    echo "AMDVLK is already installed. Skipping installation."
    exit 0
fi

echo "AMDVLK is not installed. Starting installation..."

## Step 1: Install system prerequisites (loader, tools, and deps)
echo "## Step 1: Installing system prerequisites..."
if ! apt-get -qq update; then
    handle_error
fi
if ! apt-get install -yqq --no-install-recommends \
    wget \
    libvulkan1 \
    vulkan-tools \
    libdrm-amdgpu1 \
    libdrm2 \
    libpciaccess0 \
    libnuma1 \
    libx11-6 \
    pciutils; then
    handle_error
fi

## Step 2: Download AMD driver packages
echo "## Step 2: Downloading AMD driver packages..."
mkdir -p "$TMP_DIR" || handle_error
if ! wget -q -P "$TMP_DIR" "$AMF_URL" || \
   ! wget -q -P "$TMP_DIR" "$ENC_URL" || \
   ! wget -q -P "$TMP_DIR" "$VULKAN_URL"; then
    handle_error
fi

## Step 3: Extract packages
echo "## Step 3: Extracting packages..."
mkdir -p "$EXTRACT_DIR" || handle_error
if ! dpkg-deb -x "$TMP_DIR/$(basename "$AMF_URL")" "$EXTRACT_DIR" || \
   ! dpkg-deb -x "$TMP_DIR/$(basename "$ENC_URL")" "$EXTRACT_DIR" || \
   ! dpkg-deb -x "$TMP_DIR/$(basename "$VULKAN_URL")" "$EXTRACT_DIR"; then
    handle_error
fi

## Step 4: Copy driver libraries and ICD JSON
echo "## Step 4: Installing driver libraries and ICD..."
# copy AMF runtime
if ! find "$EXTRACT_DIR" -path "*/libamfrt64.so*" -exec cp -v {} /usr/lib/ \;; then
    handle_error
fi

# copy AMD encoder
if ! find "$EXTRACT_DIR" -path "*/libamdenc64.so*" -exec cp -v {} /usr/lib/ \;; then
    handle_error
fi

# copy Vulkan ICD and helper libs
if ! find "$EXTRACT_DIR" -path "*/libVkAmd*.so*" -exec cp -v {} /usr/lib/ \;; then
    handle_error
fi
if ! find "$EXTRACT_DIR" -path "*/amdvlk64.so" -exec cp -v {} /usr/lib/amdvlk64.so \;; then
    handle_error
fi

# install ICD JSON
mkdir -p /etc/vulkan/icd.d || handle_error
JSON_SRC=$(find "$EXTRACT_DIR" -name "amd_icd64.json" | head -n1)
if [ -z "$JSON_SRC" ]; then
    echo "Error: amd_icd64.json not found in extracted packages."
    handle_error
fi
if ! sed -i 's|/opt/amdgpu-pro/lib/x86_64-linux-gnu/amdvlk64.so|/usr/lib/amdvlk64.so|g' "$JSON_SRC"; then
    handle_error
fi
if ! cp -v "$JSON_SRC" /etc/vulkan/icd.d/amd_icd64.json; then
    handle_error
fi

## Step 5: Finalize installation
echo "## Step 5: Finalizing installation..."
ldconfig || handle_error

# clean up
rm -rf "$TMP_DIR"

# Verify installation
if is_amdvlk_installed; then
    echo "--- AMDVLK installation finished successfully. ---"
    echo "You can now run: vulkaninfo --summary"
    exit 0
else
    echo "Failed to install AMDVLK."
    exit 1
fi